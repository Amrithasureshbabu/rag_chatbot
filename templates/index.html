<!DOCTYPE html>
<html>
<head>
  <title>AI Document Chatbot (Ollama)</title>
  <style>
    body { font-family: Arial; max-width: 700px; margin:auto; }
    .chat-box { border:1px solid #ccc; height:300px; overflow-y:auto; padding:10px; }
    .user { color: blue; margin-top:10px; }
    .bot { color: green; margin-top:10px; }
    textarea,input { width:100%; padding:10px; }
    button { padding:10px; width:100%; margin-top:10px; }
  </style>
</head>
<body>

<h2>ðŸ“„ AI Document Chatbot (Local - Ollama)</h2>

<h3>Upload Document</h3>
<input type="file" id="file">
<button onclick="uploadFile()">Upload & Extract</button>

<h3>Extracted Text</h3>
<pre id="docText">No document uploaded...</pre>

<h3>Chat</h3>
<div class="chat-box" id="chatBox"></div>

<textarea id="question" placeholder="Ask a question from the document..."></textarea>
<button onclick="askQuestion()">Ask</button>

<script>
async function uploadFile() {
  const file = document.getElementById("file").files[0];
  if (!file) return alert("Please select a PDF");

  const formData = new FormData();
  formData.append("file", file);

  const res = await fetch("/upload", { method: "POST", body: formData });
  const data = await res.json();

  document.getElementById("docText").textContent = data.text;
}

async function askQuestion() {
  const question = document.getElementById("question").value.trim();
  if (!question) return;

  const chatBox = document.getElementById("chatBox");

  // Display user input
  chatBox.innerHTML += `<div class="user"><b>You:</b> ${question}</div>`;

  try {
    const response = await fetch("/ask", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({ q: question })
    });

    const data = await response.json();
    chatBox.innerHTML += `<div class="bot"><b>Bot:</b> ${data.answer}</div>`;

  } catch (error) {
    chatBox.innerHTML += `<div class="bot"><b>Bot:</b> Server error</div>`;
  }

  chatBox.scrollTop = chatBox.scrollHeight;
  document.getElementById("question").value = "";
}

</script>

</body>
</html>
