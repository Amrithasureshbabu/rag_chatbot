<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AI Document Chatbot</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f4f6fb;
        }

        .container {
            width: 75%;
            margin: 40px auto;
            background: white;
            padding: 25px;
            border-radius: 10px;
        }

        h1 {
            margin-bottom: 10px;
        }

        button {
            padding: 10px 18px;
            background: #0d6efd;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        button:hover {
            background: #084298;
        }

        textarea {
            width: 100%;
            height: 80px;
            margin-top: 10px;
            padding: 8px;
            font-size: 14px;
        }

        .chat-box {
            margin-top: 15px;
            padding: 10px;
            border: 1px solid #ddd;
            height: 300px;
            overflow-y: auto;
            background: #fafafa;
        }

        .user {
            color: blue;
            margin: 6px 0;
        }

        .bot {
            color: green;
            margin: 6px 0;
        }

        .status {
            margin-top: 10px;
            font-weight: bold;
        }

        ul {
            margin-top: 5px;
        }
    </style>
</head>

<body>

<div class="container">
    <h1>üìÑ AI Document Chatbot</h1>

    <!-- ================= UPLOAD ================= -->
    <h3>1. Upload Documents</h3>

    <input type="file" id="pdfFiles" multiple accept=".pdf">
    <br><br>

    <button type="button" onclick="uploadFiles()">Upload & Process</button>

    <div id="uploadStatus" class="status"></div>
    <div id="uploadedFiles"></div>

    <!-- ================= CHAT ================= -->
    <h3 style="margin-top:25px;">2. Chat with Documents</h3>

    <div class="chat-box" id="chatBox"></div>

    <textarea id="question" placeholder="Ask your question..."></textarea>
    <br>

    <!-- IMPORTANT: type="button" -->
    <button type="button" onclick="askQuestion()">Ask Question</button>
</div>

<script>
/* ================= UPLOAD FILES ================= */
async function uploadFiles() {
    const input = document.getElementById("pdfFiles");
    const files = input.files;

    if (!files.length) {
        alert("Please select at least one PDF");
        return;
    }

    const formData = new FormData();
    for (let i = 0; i < files.length; i++) {
        formData.append("files", files[i]);
    }

    document.getElementById("uploadStatus").innerText = "Processing PDFs...";
    document.getElementById("uploadedFiles").innerHTML = "";

    const res = await fetch("/upload", {
        method: "POST",
        body: formData
    });

    const data = await res.json();

    document.getElementById("uploadStatus").innerText = data.text || "Upload complete";

    if (data.files) {
        let html = "<b>Uploaded PDFs:</b><ul>";
        data.files.forEach(f => {
            html += `<li>${f}</li>`;
        });
        html += "</ul>";
        document.getElementById("uploadedFiles").innerHTML = html;
    }
}

/* ================= ASK QUESTION ================= */
async function askQuestion() {
    const textarea = document.getElementById("question");
    const q = textarea.value.trim();

    if (!q) {
        alert("Please enter a question");
        return;
    }

    const chatBox = document.getElementById("chatBox");

    /* 1Ô∏è‚É£ Show user question immediately */
    chatBox.innerHTML += `
        <div class="user"><b>You:</b> ${q}</div>
    `;

    textarea.value = "";
    chatBox.scrollTop = chatBox.scrollHeight;

    /* 2Ô∏è‚É£ Call backend */
    const res = await fetch("/ask", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ q })
    });

    const data = await res.json();

    const answer = data.answer || "Not found in document";

    /* 3Ô∏è‚É£ Show bot answer */
    chatBox.innerHTML += `
        <div class="bot"><b>Bot:</b> ${answer}</div>
    `;

    chatBox.scrollTop = chatBox.scrollHeight;
}
</script>

</body>
</html>
